# Project Overview: Safe Changes & Local CI Pipeline for Prompt Manager

## 1. Introduction

This document outlines the "Safe Changes" initiative for the **Prompt Manager** project, a Python FastAPI/Starlette + JS application for managing AI prompts. The primary goal is to enhance development velocity and reduce regressions by establishing a robust local Continuous Integration (CI) pipeline and refining development practices.

## 2. Problem Statement

The Prompt Manager project has experienced a slowdown in development velocity due to a higher-than-desired rate of regressions when new features are introduced. While unit and API test coverage exists, it has not been sufficient to catch all issues. Furthermore, end-to-end (E2E) tests, particularly those generated by AI, currently require significant manual intervention and validation, consuming valuable developer time.

## 3. Goals

The "Safe Changes" initiative aims to:

-   **Automate Comprehensive Testing Locally:** Implement a system where unit, API, and E2E tests can be run easily and consistently by developers on their local machines.
-   **Reduce Human Effort & Regressions:** Minimize the manual effort required during feature development, testing, and rollout, thereby reducing the likelihood of introducing bugs.
-   **Enhance AI-Generated E2E Test Autonomy:** Improve the process for AI to write and validate Playwright E2E tests with greater autonomy, leveraging techniques like trace-based generation.
-   **Maintain Reproducible & Lightweight Workflows:** Ensure that all development and testing workflows are easily reproducible across developer setups and remain lightweight enough to run efficiently on a typical laptop.
-   **Improve Code Quality Incrementally:** Adopt practices like adding Pydantic types and type hints to files as they are modified, promoting a "boy scout rule" approach to codebase improvement.

## 4. Chosen Approach & Tooling

### 4.1. Local CI Orchestration

To orchestrate the various development tasks (linting, type checking, testing, etc.), we will use **Taskfile (`Taskfile.yml`)**.

**Justification for Taskfile:**
-   **Simplicity and Clarity:** Uses YAML, which is easy to read and write.
-   **Lightweight and Cross-Platform:** A single binary, suitable for all developer laptops.
-   **Powerful Orchestration:** Effectively manages dependencies between tasks (e.g., lint -> test -> e2e).
-   **Language Agnostic:** Capable of running any shell command, making it suitable for our Python and JavaScript/TypeScript stack.
-   **Extensibility:** Easily adaptable for future needs, such as build or deployment steps.

### 4.2. Pydantic Types & Type Hinting

Pydantic types and general type hints will be added/improved **incrementally** whenever a file is modified for other reasons (e.g., new feature, bug fix). This staged approach minimizes disruption and aligns with the goal of making continuous, safe improvements.

### 4.3. Playwright E2E Test Enhancements

We will focus on several strategies to improve the E2E testing workflow with Playwright:
-   **Trace-based Test Generation:** Develop a process where manual UI walkthroughs can be recorded as Playwright traces, which are then provided to an AI to generate corresponding E2E test scripts.
-   **Canonical Test Seeding:** Create and maintain a set of manually curated, high-quality Playwright tests to serve as examples and templates for AI-generated tests.
-   **Auto-scaffolding New Route Tests:** Explore methods for AI to automatically generate basic test scaffolds for new frontend routes, ensuring essential rendering and navigation are covered.

## 5. Expected Outcome

The successful implementation of the "Safe Changes" initiative will result in a fully local, developer-friendly CI pipeline. This pipeline will:
-   Improve confidence in both human-written and AI-generated code and tests.
-   Significantly reduce the occurrence of regressions.
-   Enable faster iteration cycles with less human-in-the-loop effort for testing and validation.
-   Foster a culture of quality and robust development practices.

This overview will be supported by a detailed `safe_changes_implementation_plan.md` that breaks down the required steps. 